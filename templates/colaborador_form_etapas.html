{% extends "base.html" %}

{% block title %}Novo Colaborador - Sistema NEV USP{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="page-header mb-4">
                <h1 class="h3 mb-0">
                    <i class="fas fa-user-plus me-2"></i>Novo Colaborador
                </h1>
                <p class="text-muted mb-0">Cadastre um novo colaborador em 5 passos</p>
            </div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="multi-step-form">
                        <div class="step-indicator">
                            <div class="step" data-step="1">
                                <div class="step-circle">1</div>
                                <div class="step-label">Identificação</div>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-circle">2</div>
                                <div class="step-label">Contato</div>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-circle">3</div>
                                <div class="step-label">Institucional</div>
                            </div>
                            <div class="step" data-step="4">
                                <div class="step-circle">4</div>
                                <div class="step-label">Imprensa</div>
                            </div>
                            <div class="step" data-step="5">
                                <div class="step-circle">5</div>
                                <div class="step-label">Acadêmico</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Steps -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form id="formColaboradorEtapas" method="POST">
                        <!-- CSRF Token para Flask-WTF (se estiver usando) -->
                        {% if csrf_token %}
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        {% endif %}
                        
                        <!-- Step 1: Identificação -->
                        <div class="step-content" id="step-1">
                            <h4 class="mb-4"><i class="fas fa-id-card me-2"></i>Passo 1: Identificação</h4>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nome_completo" class="form-label">Nome Completo *</label>
                                    <input type="text" class="form-control" id="nome_completo" name="nome_completo" required>
                                    <div class="invalid-feedback">Por favor, informe o nome completo.</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="nome_social" class="form-label">Nome Social (se houver)</label>
                                    <input type="text" class="form-control" id="nome_social" name="nome_social">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="cpf" class="form-label">CPF *</label>
                                    <input type="text" class="form-control cpf" id="cpf" name="cpf" required 
                                           placeholder="000.000.000-00">
                                    <div class="invalid-feedback">Por favor, informe um CPF válido.</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="rg" class="form-label">RG</label>
                                    <input type="text" class="form-control" id="rg" name="rg">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="data_nascimento" class="form-label">Data de Nascimento</label>
                                    <input type="date" class="form-control" id="data_nascimento" name="data_nascimento">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 2: Contato -->
                        <div class="step-content" id="step-2" style="display: none;">
                            <h4 class="mb-4"><i class="fas fa-address-book me-2"></i>Passo 2: Contato</h4>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="email_institucional" class="form-label">Email Institucional *</label>
                                    <input type="email" class="form-control" id="email_institucional" name="email_institucional" required>
                                    <div class="invalid-feedback">Por favor, informe um email válido.</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="celular" class="form-label">Celular *</label>
                                    <input type="tel" class="form-control telefone" id="celular" name="celular" required 
                                           placeholder="(00) 00000-0000">
                                    <div class="invalid-feedback">Por favor, informe um celular válido.</div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="whatsapp" name="whatsapp">
                                        <label class="form-check-label" for="whatsapp">
                                            Este número tem WhatsApp
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <h5 class="mt-4 mb-3">Endereço</h5>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="cep" class="form-label">CEP</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control cep" id="cep" name="cep" 
                                               placeholder="00000-000">
                                        <button class="btn btn-outline-secondary" type="button" id="btnBuscarCEP">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-8 mb-3">
                                    <label for="endereco" class="form-label">Endereço</label>
                                    <input type="text" class="form-control" id="endereco" name="endereco">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="numero" class="form-label">Número</label>
                                    <input type="text" class="form-control" id="numero" name="numero">
                                </div>
                                
                                <div class="col-md-5 mb-3">
                                    <label for="bairro" class="form-label">Bairro</label>
                                    <input type="text" class="form-control" id="bairro" name="bairro">
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="cidade" class="form-label">Cidade</label>
                                    <input type="text" class="form-control" id="cidade" name="cidade">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="estado" class="form-label">Estado</label>
                                    <select class="form-select" id="estado" name="estado">
                                        <option value="">Selecione...</option>
                                        <option value="AC">AC</option>
                                        <option value="AL">AL</option>
                                        <option value="AP">AP</option>
                                        <option value="AM">AM</option>
                                        <option value="BA">BA</option>
                                        <option value="CE">CE</option>
                                        <option value="DF">DF</option>
                                        <option value="ES">ES</option>
                                        <option value="GO">GO</option>
                                        <option value="MA">MA</option>
                                        <option value="MT">MT</option>
                                        <option value="MS">MS</option>
                                        <option value="MG">MG</option>
                                        <option value="PA">PA</option>
                                        <option value="PB">PB</option>
                                        <option value="PR">PR</option>
                                        <option value="PE">PE</option>
                                        <option value="PI">PI</option>
                                        <option value="RJ">RJ</option>
                                        <option value="RN">RN</option>
                                        <option value="RS">RS</option>
                                        <option value="RO">RO</option>
                                        <option value="RR">RR</option>
                                        <option value="SC">SC</option>
                                        <option value="SP">SP</option>
                                        <option value="SE">SE</option>
                                        <option value="TO">TO</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 3: Institucional -->
                        <div class="step-content" id="step-3" style="display: none;">
                            <h4 class="mb-4"><i class="fas fa-university me-2"></i>Passo 3: Dados Institucionais</h4>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="tipo_vinculo" class="form-label">Tipo de Vínculo *</label>
                                    <select class="form-select" id="tipo_vinculo" name="tipo_vinculo" required>
                                        <option value="">Selecione...</option>
                                        <option value="Bolsista">Bolsista</option>
                                        <option value="Estagiário">Estagiário</option>
                                        <option value="Funcionário">Funcionário</option>
                                        <option value="Pesquisador">Pesquisador</option>
                                        <option value="Professor">Professor</option>
                                        <option value="Técnico">Técnico</option>
                                        <option value="Voluntário">Voluntário</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                    <div class="invalid-feedback">Por favor, selecione o tipo de vínculo.</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="data_ingresso" class="form-label">Data de Ingresso *</label>
                                    <input type="date" class="form-control" id="data_ingresso" name="data_ingresso" required>
                                    <div class="invalid-feedback">Por favor, informe a data de ingresso.</div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="departamento" class="form-label">Linha de Pesquisa/Departamento</label>
                                    <input type="text" class="form-control" id="departamento" name="departamento">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="lotacao" class="form-label">Lotação</label>
                                    <input type="text" class="form-control" id="lotacao" name="lotacao">
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label class="form-label">Dias Presenciais</label>
                                    <div class="d-flex flex-wrap gap-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dia_seg" name="dias_presenciais" value="Segunda">
                                            <label class="form-check-label" for="dia_seg">Segunda</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dia_ter" name="dias_presenciais" value="Terça">
                                            <label class="form-check-label" for="dia_ter">Terça</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dia_qua" name="dias_presenciais" value="Quarta">
                                            <label class="form-check-label" for="dia_qua">Quarta</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dia_qui" name="dias_presenciais" value="Quinta">
                                            <label class="form-check-label" for="dia_qui">Quinta</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dia_sex" name="dias_presenciais" value="Sexta">
                                            <label class="form-check-label" for="dia_sex">Sexta</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="dia_sab" name="dias_presenciais" value="Sábado">
                                            <label class="form-check-label" for="dia_sab">Sábado</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 4: Imprensa -->
                        <div class="step-content" id="step-4" style="display: none;">
                            <h4 class="mb-4"><i class="fas fa-newspaper me-2"></i>Passo 4: Dados para Imprensa</h4>
                            
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="atende_imprensa" name="atende_imprensa">
                                        <label class="form-check-label" for="atende_imprensa">
                                            <strong>Atende a pedidos de Imprensa?</strong>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label class="form-label">Tipos de Veículos de Imprensa (se atende)</label>
                                    <div class="d-flex flex-wrap gap-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tipo_jornal" name="tipos_imprensa" value="Jornal">
                                            <label class="form-check-label" for="tipo_jornal">Jornal</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tipo_revista" name="tipos_imprensa" value="Revista">
                                            <label class="form-check-label" for="tipo_revista">Revista</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tipo_tv" name="tipos_imprensa" value="TV">
                                            <label class="form-check-label" for="tipo_tv">TV</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tipo_radio" name="tipos_imprensa" value="Rádio">
                                            <label class="form-check-label" for="tipo_radio">Rádio</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tipo_portal" name="tipos_imprensa" value="Portal Online">
                                            <label class="form-check-label" for="tipo_portal">Portal Online</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tipo_blog" name="tipos_imprensa" value="Blog">
                                            <label class="form-check-label" for="tipo_blog">Blog</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-12">
                                    <label for="assuntos_especializacao" class="form-label">Temas de Especialidade/Assuntos para entrevista</label>
                                    <textarea class="form-control" id="assuntos_especializacao" name="assuntos_especializacao" rows="3"></textarea>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="disponibilidade_contato" class="form-label">Disponibilidade para Contato</label>
                                    <select class="form-select" id="disponibilidade_contato" name="disponibilidade_contato">
                                        <option value="">Selecione...</option>
                                        <option value="Segunda a Sexta, 9h-18h">Segunda a Sexta, 9h-18h</option>
                                        <option value="Somente com agendamento">Somente com agendamento</option>
                                        <option value="Por email">Por email</option>
                                        <option value="Por telefone">Por telefone</option>
                                        <option value="Qualquer horário">Qualquer horário</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 5: Acadêmico -->
                        <div class="step-content" id="step-5" style="display: none;">
                            <h4 class="mb-4"><i class="fas fa-graduation-cap me-2"></i>Passo 5: Dados Acadêmicos/Profissionais</h4>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="curriculo_lattes" class="form-label">Currículo Lattes (URL)</label>
                                    <input type="url" class="form-control" id="curriculo_lattes" name="curriculo_lattes" placeholder="https://lattes.cnpq.br/...">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="orcid" class="form-label">ORCID</label>
                                    <input type="text" class="form-control" id="orcid" name="orcid" placeholder="0000-0000-0000-0000">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="linkedin" class="form-label">LinkedIn (URL)</label>
                                    <input type="url" class="form-control" id="linkedin" name="linkedin" placeholder="https://linkedin.com/in/...">
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-12">
                                    <label for="observacoes" class="form-label">Observações Gerais</label>
                                    <textarea class="form-control" id="observacoes" name="observacoes" rows="4"></textarea>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Último passo!</strong> Revise os dados e clique em "Finalizar Cadastro" para salvar o colaborador.
                            </div>
                        </div>
                        
                        <!-- Navigation Buttons -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" id="btnVoltar" style="display: none;">
                                        <i class="fas fa-arrow-left me-2"></i>Voltar
                                    </button>
                                    
                                    <div class="ms-auto">
                                        <button type="button" class="btn btn-primary" id="btnProximo">
                                            <i class="fas fa-arrow-right me-2"></i>Próximo Passo
                                        </button>
                                        
                                        <button type="button" class="btn btn-success" id="btnFinalizar" style="display: none;">
                                            <i class="fas fa-check me-2"></i>Finalizar Cadastro
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.multi-step-form {
    margin-bottom: 2rem;
}

.step-indicator {
    display: flex;
    justify-content: space-between;
    position: relative;
    margin-bottom: 1rem;
}

.step-indicator::before {
    content: '';
    position: absolute;
    top: 15px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: #dee2e6;
    z-index: 1;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
}

.step-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #dee2e6;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
}

.step-label {
    font-size: 0.875rem;
    color: #6c757d;
    text-align: center;
    transition: all 0.3s ease;
}

.step.active .step-circle {
    background-color: #0d6efd;
    color: white;
    transform: scale(1.1);
}

.step.active .step-label {
    color: #0d6efd;
    font-weight: 600;
}

.step.completed .step-circle {
    background-color: #198754;
    color: white;
}

.step.completed .step-label {
    color: #198754;
}

.step-content {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    let currentStep = 1;
    const totalSteps = 5;
    
    // Função para atualizar a visualização dos passos
    function updateStepView() {
        // Esconder todos os passos
        $('.step-content').hide();
        
        // Mostrar passo atual
        $(`#step-${currentStep}`).show();
        
        // Atualizar indicador de progresso
        $('.step').removeClass('active completed');
        
        for (let i = 1; i <= totalSteps; i++) {
            const $step = $(`.step[data-step="${i}"]`);
            
            if (i < currentStep) {
                $step.addClass('completed');
            } else if (i === currentStep) {
                $step.addClass('active');
            }
        }
        
        // Atualizar botões de navegação
        $('#btnVoltar').toggle(currentStep > 1);
        $('#btnProximo').toggle(currentStep < totalSteps);
        $('#btnFinalizar').toggle(currentStep === totalSteps);
    }
    
    // Função para validar o passo atual
    function validateCurrentStep() {
        const $currentStep = $(`#step-${currentStep}`);
        let isValid = true;
        
        // Validar campos obrigatórios do passo atual
        $currentStep.find('[required]').each(function() {
            const $field = $(this);
            
            if (!$field.val().trim()) {
                $field.addClass('is-invalid');
                isValid = false;
                
                // Scroll para o primeiro campo inválido
                if (isValid === false) {
                    $('html, body').animate({
                        scrollTop: $field.offset().top - 100
                    }, 500);
                }
            } else {
                $field.removeClass('is-invalid');
            }
        });
        
        // Validação específica para CPF
        if (currentStep === 1) {
            const cpf = $('#cpf').val().replace(/\D/g, '');
            if (cpf.length === 11) {
                $('#cpf').removeClass('is-invalid');
            } else if ($('#cpf').is(':required')) {
                $('#cpf').addClass('is-invalid');
                isValid = false;
            }
        }
        
        // Validação específica para email
        if (currentStep === 2) {
            const email = $('#email_institucional').val();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email && !emailRegex.test(email)) {
                $('#email_institucional').addClass('is-invalid');
                isValid = false;
            }
        }
        
        return isValid;
    }
    
    // Função para salvar os dados do passo atual
    function saveCurrentStep() {
        const formData = new FormData();
        formData.append('acao', 'salvar_passo');
        formData.append('passo', currentStep);
        
        // Coletar dados do passo atual
        $(`#step-${currentStep} :input`).each(function() {
            const $input = $(this);
            const name = $input.attr('name');
            
            if (name) {
                if ($input.attr('type') === 'checkbox') {
                    if ($input.is(':checked')) {
                        formData.append(name, $input.val());
                    }
                } else if ($input.attr('type') === 'radio') {
                    if ($input.is(':checked')) {
                        formData.append(name, $input.val());
                    }
                } else {
                    formData.append(name, $input.val());
                }
            }
        });
        
        // Enviar dados via AJAX
        return $.ajax({
            url: "{{ url_for('novo_colaborador') }}",
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        });
    }
    
    // Evento: Próximo passo
    $('#btnProximo').click(function() {
        if (validateCurrentStep()) {
            saveCurrentStep().done(function(response) {
                if (response.success) {
                    currentStep++;
                    updateStepView();
                }
            }).fail(function(xhr) {
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    showAlert('danger', xhr.responseJSON.message);
                } else {
                    showAlert('danger', 'Erro ao salvar os dados. Tente novamente.');
                }
            });
        }
    });
    
    // Evento: Voltar
    $('#btnVoltar').click(function() {
        currentStep--;
        updateStepView();
    });
    
    // Evento: Finalizar cadastro
    $('#btnFinalizar').click(function() {
        if (validateCurrentStep()) {
            // Primeiro salva o último passo
            saveCurrentStep().done(function() {
                // Depois envia todos os dados para finalizar
                const formData = new FormData();
                formData.append('acao', 'finalizar_cadastro');
                
                $.ajax({
                    url: "{{ url_for('novo_colaborador') }}",
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                }).done(function(response) {
                    if (response.success) {
                        showAlert('success', response.message);
                        
                        // Redirecionar após 2 segundos
                        setTimeout(function() {
                            window.location.href = response.redirect_url;
                        }, 2000);
                    } else {
                        showAlert('danger', response.message);
                    }
                }).fail(function(xhr) {
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        showAlert('danger', xhr.responseJSON.message);
                    } else {
                        showAlert('danger', 'Erro ao finalizar cadastro. Tente novamente.');
                    }
                });
            }).fail(function(xhr) {
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    showAlert('danger', xhr.responseJSON.message);
                } else {
                    showAlert('danger', 'Erro ao salvar os dados. Tente novamente.');
                }
            });
        }
    });
    
    // Evento: Buscar CEP
    $('#btnBuscarCEP').click(function() {
        const cep = $('#cep').val().replace(/\D/g, '');
        
        if (cep.length === 8) {
            $.getJSON("{{ url_for('api_buscar_cep', cep='') }}" + cep, function(data) {
                if (data.success && data.endereco) {
                    $('#endereco').val(data.endereco.logradouro || '');
                    $('#bairro').val(data.endereco.bairro || '');
                    $('#cidade').val(data.endereco.cidade || '');
                    $('#estado').val(data.endereco.estado || '');
                    
                    if (data.message) {
                        showAlert('info', data.message);
                    }
                } else {
                    showAlert('warning', 'CEP não encontrado. Preencha os dados manualmente.');
                }
            }).fail(function() {
                showAlert('danger', 'Erro ao buscar CEP. Tente novamente.');
            });
        } else {
            showAlert('warning', 'Digite um CEP válido (8 dígitos).');
        }
    });
    
    // Remover validação quando o usuário começa a digitar
    $('input, select, textarea').on('input change', function() {
        $(this).removeClass('is-invalid');
    });
    
    // Função para mostrar alertas
    function showAlert(type, message) {
        // Remover alertas anteriores
        $('.alert-dismissible').remove();
        
        // Criar novo alerta
        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade show mt-3" role="alert">
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        `;
        
        // Adicionar após o header
        $('.page-header').after(alertHtml);
        
        // Auto-remover após 5 segundos (exceto para sucesso)
        if (type !== 'success') {
            setTimeout(function() {
                $('.alert-dismissible').alert('close');
            }, 5000);
        }
    }
    
    // Inicializar visualização
    updateStepView();
});
</script>
{% endblock %}